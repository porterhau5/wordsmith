# Automatically update latest release with each commit
#environment:
    # Tell msys2 to add mingw64 to the path
    #MSYSTEM: MINGW64
    # Tell msys2 to inherit the current directory when starting the shell
    #CHERE_INVOKING: 1

before_deploy:
 #- ps: $env:VER=sls "^## " .\CHANGELOG.md | select -exp line | select -first 1 | ForEach-Object { $_.split("]")[0] } | ForEach-Object { $_.split("[")[1] }
 #- ps: Set-AppveyorBuildVariable 'ver' sls "^## " .\CHANGELOG.md | select -exp line | select -first 1 | ForEach-Object { $_.split("]")[0] } | ForEach-Object { $_.split("[")[1] }
 - ps: Set-AppveyorBuildVariable -Name VER -Value (sls "^## " .\CHANGELOG.md | select -exp line | select -first 1 | ForEach-Object { $_.split("]")[0] } | ForEach-Object { $_.split("[")[1] })
 #- ps:  -Name LIBIIO_VERSION -Value (get-content .version)

deploy:
  - provider: GitHub
    tag: v$(VER)
    description: 'Contains the most recent code and data archive for use with Wordsmith ($(APPVEYOR_REPO_COMMIT)). After cloning/downloading the Wordsmith repository, download `data.tar.xz` and place inside wordsmith directory.'
    force_update: true
    auth_token:
      secure: LGNzTMUPT4zvTNSh2VBYQ6Uy2JH0e79jONqr3bCB1yjHhTDxnGWSpmKWjRtItp2c

# Don't actually build.
build: off

branches:
  only:
    - master
